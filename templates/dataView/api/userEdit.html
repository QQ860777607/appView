<!DOCTYPE html>
{% load static %}
<html>
<head>
    <title>用户注册</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="{% static 'layuimini/lib/layui-v2.5.5/css/layui.css' %}" media="all">
  <style>
  .layui-input-block{width: 512px; height: 80px}
  </style>
</head>
<body>
    <div class="layui-fluid">
    <div class="layui-card">
    <div class="layui-card-body" style="padding: 15px;">
    <form class="layui-form" action="">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">注册账号</label>
                <div class="layui-input-inline">
                    <input type="text" name="userName" id="userName" autocomplete="off" value="{{ data.userName }}" disabled class="layui-input layui-disabled" />
                </div>
            </div>

        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">姓名</label>
                <div class="layui-input-inline">
                    <input type="text" name="realName" id="realName" lay-verify="required|realName" value="{{ data.realName }}" placeholder="输入中文名" autocomplete="off" class="layui-input" />
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">出生日期</label>
                <div class="layui-input-inline">
                    <input type="text" name="uBDate" id="date" value="{{ data.uBDate }}" placeholder="请选择" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-inline">
                    <input type="radio" name="uSex" value="1" title="男" {% if data.uSex == '男' %} checked="" {% endif %} />
                    <input type="radio" name="uSex" value="2" title="女" {% if data.uSex == '女' %} checked="" {% endif %} />
                </div>
            </div>

            <div class="layui-inline">
                <label class="layui-form-label">身份证</label>
                <div class="layui-input-inline">
                    <input type="text" name="identity" lay-verify="identity" value="{{ data.identity }}" placeholder="" autocomplete="off" class="layui-input" />
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">学历</label>
                <div class="layui-input-inline">
                    <select name="uCollege">
                        {% for v in arrayEducation %}
                            <option {% if data.uCollege == v %} selected {% endif %} value="{{ forloop.counter }}">{{ v }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">个人爱好</label>
                <div class="layui-input-inline">
                    <input type="text" name="uHobbies" value="{{ data.uHobbies }}" placeholder="请输入" autocomplete="off" class="layui-input" />
                </div>
            </div>

        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">用户照片</label>
                <div class="layui-input-block" style="height:130px">
                    <div id="cupload-1">
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">邮箱</label>
                <div class="layui-input-inline">
                    <input type="text" name="userMail" value="{{ data.userMail }}" placeholder="xx@xx.xx" autocomplete="off" class="layui-input" />
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">入职日期</label>
                <div class="layui-input-inline">
                    <input type="text" name="uDate" id="uDate" lay-verify="date" value="{{ data.uDate }}" placeholder="请选择" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-form-label">所属区域</div>
                <div class="layui-input-inline" style="width: 164px;">
                    <select name="uProvince" id="uProvince" lay-filter="uProvince">
						<option value="">选择省</option>
					</select>
                </div>
                <div class="layui-input-inline" style="width: 165px;">
                    <select name="uCity" id="uCity" lay-filter="uCity">
						<option value="">选择市</option>
					</select>
                </div>
                <div class="layui-input-inline" style="width: 164px;">
                    <select name="uCounty" id="uCounty" lay-filter="uCounty">
						<option value="">选择县区</option>
					</select>
                </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">街道门牌</label>
                <div class="layui-input-inline">
                    <input type="text" name="uStreet" lay-verify="title" value="{{ data.uStreet }}" placeholder="请输入" autocomplete="off" class="layui-input" style="width: 513px;"/>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">用户状态</label>
            <div class="layui-input-inline">
                <input type="checkbox" {% if data.status == '正常' %} checked {% endif %} name="status" lay-skin="switch" lay-text="正常|冻结" />
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">个人简介</label>
            <div class="layui-input-block">
                <textarea name="description" placeholder="请输入内容" class="layui-textarea">{{ data.description }}</textarea>
            </div>
        </div>
      <div class="layui-form-item layui-layout-admin">
       <div class="layui-input-inlink">
        <div class="layui-footer" style="left: 0;">
         <input class="layui-btn layui-btn-normal" type="button" lay-submit lay-filter="component-form-demo1" value="确认修改">
        </div>
       </div>
      </div>
     </form>
        <input hidden id="is_refresh" value="true">
    </div>
   </div>
  </div>
</body>
<script src="{% static 'layuimini/lib/layui-v2.5.5/layui.js' %}" charset="utf-8"></script>
<script src="{% static 'layuimini/js/fileupload.js' %}" charset="utf-8"></script>
<script src="{% static 'layuimini/js/areadata.js' %}" charset="utf-8"></script>
<script type="text/javascript">
    var config = {
        s1: 'uProvince',
        s2: 'uCity',
        s3: 'uCounty',
        v1: {% if data.uProvince %}{{ data.uProvince }}{% else %}''{% endif %},
        v2: {% if data.uCity %}{{ data.uCity }}{% else %}''{% endif %},
        v3: {% if data.uCounty %}{{ data.uCounty }}{% else %}''{% endif %},
    };
    treeSelect(config);
    function treeSelect(config) {
        layui.define(['jquery', 'form'], function () {
            var $ = layui.jquery, form = layui.form, $form = $('form');
            config.v1 = config.v1 ? config.v1 : null;
            config.v2 = config.v2 ? config.v2 : null;
            config.v3 = config.v3 ? config.v3 : null;
            $.each(threeSelectData, function (k, v) {
                appendOptionTo($form.find('select[name=' + config.s1 + ']'), k, v.val, config.v1);
            });
            form.render();
            cityEvent(config);
            areaEvent(config);
            form.on('select(' + config.s1 + ')', function (data) {
                cityEvent(data);
                form.on('select(' + config.s2 + ')', function (data) {
                    areaEvent(data);
                });
            });
            function cityEvent(data) {
                $form.find('select[name=' + config.s2 + ']').html("");
                config.v1 = data.value ? data.value : config.v1;
                $.each(threeSelectData, function (k, v) {
                    if (v.val == config.v1) {
                        if (v.items) {
                            $.each(v.items, function (kt, vt) {
                                appendOptionTo($form.find('select[name=' + config.s2 + ']'), kt, vt.val, config.v2);
                            });
                        }
                    }
                });
                form.render();
                config.v2 = $('select[name=' + config.s2 + ']').val();
                areaEvent(config);
            }
            function areaEvent(data) {
                $form.find('select[name=' + config.s3 + ']').html("");
                config.v2 = data.value ? data.value : config.v2;
                $.each(threeSelectData, function (k, v) {
                    if (v.val == config.v1) {
                        if (v.items) {
                            $.each(v.items, function (kt, vt) {
                                if (vt.val == config.v2) {
                                    $.each(vt.items, function (ka, va) {
                                        appendOptionTo($form.find('select[name=' + config.s3 + ']'), ka, va, config.v3);
                                    });
                                }
                            });
                        }
                    }
                });
                form.render();
                form.on('select(' + config.s3 + ')', function (data) { });
            }
            function appendOptionTo($o, k, v, d) {
                var $opt = $("<option>").text(k).val(v);
                if (v == d) { $opt.attr("selected", "selected") }
                $opt.appendTo($o);
            }
        });
    }
</script>
<script>


layui.use(['jquery', 'form', 'laydate'], function(){
    var form = layui.form
        ,$ = layui.jquery
        ,layer = layui.layer
        ,laydate = layui.laydate;
    form.verify({
        //密码的验证
        pass: [/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/,'密码必须6到12位，且不能出现空格'],
        realName: [/[\u4e00-\u9fa5]{2,10}$/,'请使用中文名，至少两个汉字']
    });

    //日期
    laydate.render({
        elem: '#date'
    });
    laydate.render({
        elem: '#uDate'
    });
    /* 监听提交 */
    form.on('submit(component-form-demo1)', function(data){
		$.post("../userEdit/edit",{name:JSON.stringify(data.field), do:2},function (res) {
			res = JSON.parse(res);
			if (res.message==='ok') {
			    if ($('#is_refresh').val()){
			        parent.location.reload()
			    }else{
			        parent.$(sessionStorage.getItem("dp_post_click")).click()
                }
				var index = parent.layer.getFrameIndex(window.name);
				parent.layer.close(index);
				parent.layer.msg('已更新！', {icon: 1});

			} else{
				layer.msg("网络错误，请重试");
			}
		});
        return false; // false不重置，true重置表单
    });

    var filepath = new Cupload ({
        img:  'data:image/png;base64,{{ data.uPhotos|safe }}',
        ele: '#cupload-1'
    })
});
</script>
</html>